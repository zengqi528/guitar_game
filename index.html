<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="format-detection" content="telephone=no">
    <title>Fret Master PWA</title>
    <link rel="apple-touch-icon" href="icon.png">

    <style>
        :root {
            --bg-color: #f8f9fa;
            --text-color: #333;
            --accent-color: #007aff;
            --correct-color: #34c759;
            --wrong-color: #ff3b30;
            --board-bg: #e4d0a6;
        }

        * { box-sizing: border-box; -webkit-tap-highlight-color: transparent; touch-action: manipulation; }

        body {
            margin: 0; padding: 0;
            font-family: -apple-system, BlinkMacSystemFont, sans-serif;
            background-color: var(--bg-color);
            color: var(--text-color);
            height: 100vh;
            overflow: hidden;
            display: flex; flex-direction: column;
            user-select: none; -webkit-user-select: none;
        }

        /* --- 调试日志窗口 (屏幕底部) --- */
        #debug-console {
            position: fixed; bottom: 0; left: 0; width: 100%; height: 60px;
            background: rgba(0,0,0,0.8); color: lime; font-family: monospace;
            font-size: 10px; padding: 5px; overflow-y: scroll; z-index: 99999;
            pointer-events: none; display: none; /* 默认隐藏，出错时显示 */
            white-space: pre-wrap;
        }

        /* --- 遮罩层 --- */
        #overlay {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background: rgba(255,255,255,0.98); z-index: 9999;
            display: flex; flex-direction: column; justify-content: center; align-items: center;
        }
        
        /* 巨大的点击热区，确保能点到 */
        .btn-start {
            background: var(--accent-color); color: white;
            border: none; padding: 25px 60px; font-size: 1.5rem; border-radius: 60px;
            font-weight: bold; box-shadow: 0 10px 25px rgba(0,122,255,0.3);
            margin-top: 20px; cursor: pointer;
            position: relative; overflow: hidden;
        }
        /* 点击时的视觉反馈 */
        .btn-start:active { transform: scale(0.95); background: #0056b3; }

        /* --- 游戏 UI --- */
        header {
            height: 60px; padding: 0 20px; padding-top: env(safe-area-inset-top);
            background: rgba(255,255,255,0.95); border-bottom: 1px solid #e0e0e0;
            display: flex; justify-content: space-between; align-items: center;
        }
        .score-board strong { font-size: 1.2rem; }
        .high-score { text-align: right; font-size: 0.8rem; color: var(--accent-color); font-weight: 600; }

        #game-container {
            flex: 1; position: relative; display: flex; flex-direction: column; justify-content: center;
            background: linear-gradient(to bottom, #f0f0f5, #fff); overflow: hidden;
        }

        #fretboard-scroll {
            width: 100%; overflow-x: auto; -webkit-overflow-scrolling: touch;
            padding: 40px 0; display: flex; justify-content: center; 
        }

        #fretboard {
            position: relative; min-width: 900px; height: 220px;
            background-color: var(--board-bg);
            background-image: repeating-linear-gradient(90deg, transparent, transparent 2px, rgba(160,120,60,0.1) 2px, rgba(160,120,60,0.1) 4px);
            box-shadow: 0 10px 30px rgba(0,0,0,0.15);
            border-top: 4px solid #d4c095; border-bottom: 4px solid #d4c095;
            margin: 0 20px;
        }

        .fret { position: absolute; top: 0; bottom: 0; width: 3px; background: #c0c0c0; box-shadow: 1px 0 2px rgba(0,0,0,0.3); }
        .nut { posit
